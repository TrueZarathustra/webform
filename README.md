# Тестовое задание
## Воротников Владимир

В данном документе описано:
1. Структура проекта, как устроено предлагаемое решение
2. Как запустить проект
3. Прочее

## 1. Структура проекта
### 1.1 Используемые технологии
При решении поставленной задачи были использованы следующие инструменты и технологии:
 - Python (FastAPI, requests)
 - MongoDB
 - Docker

### 1.2 Состав и назначение файлов
В проекте присутствуют следующие файлы:
 - helper_functions.py 
 - init_db.py
 - predefined_tests.py
 - webforms.py

Основной файл - webforms.py:<br>
При запуске он открывает сокет и ждёт HTTP POST запрос на /get_form<br>
Далее осуществляется поиск шаблона, подходящего под переданную ему форму

Файл init_db.py:<br>
Создаёт БД, в ней создает коллекцию и заполняет тестовыми шаблонами

Файл helper_functions.py:<br>
Содержит вспомогательные функции: валидаторы для разных типов данных, функции поиска и сравнения присланной формы и шаблона

Файл predefined_tests.py:<br>
Содержит 7 тестовых примеров обращения к webforms. По первым 5 шаблон должен быть найдет, по последним двум - нет

## 2. Запуск и проверка
### 2.1 Предварительная подготовка
Нужно скачать docker-image отсюда: https://drive.google.com/file/d/1rENfQ6zoMeYf05xHWEQdm__rqY32jhnI и положить его на устройство с установленным docker-ом<br>

Далее следует импортировать его и запустить командами:<br>
`
docker import webform.tar
`
<br>
`
docker run -ti <image-id> /bin/bash
`

### 2.2 Запуск сервисов и проверка работоспособности
Следует запустить БД и заполнить БД, а также запустить веб-сервис следующими командами:<br>
```
mongod --quiet --fork --syslog
/webform/init_db.py
/webform/webforms.py &
```

После этого можно запустить тестовые примеры:<br>
`/webform/predefined_tests.py`

В результате получаем следующий вывод:<br>

```
Start testing. Expect to find only first 5 templates

Check case:  customer=Max&customer_mail=max@maxmail.ru&customer_phone=+79991112233&registered=12.07.2018
Output:  "typical form"

Check case:  admin_mail=admin@admin.pro&admin_phone=+71234567890
Output:  "admin contacts"

Check case:  order_date=2020-10-10&details=Order num 1233. Very important!
Output:  "order info"

Check case:  mailgroup=mymails&main_email=me@memail.com&secondary_mail=metoo@memail.com&emergency_mail=em@memail.com
Output:  "mail list"

Check case:  author=Cool Author&comment=the good one
Output:  "comments"

Check case:  Last date=2010-03-23&comment=some text
Output:  {"Last date":"date","comment":"text"}

Check case:  admin_mail=admin@admin.pro&admin_phone=CALLME
Output:  {"admin_mail":"email","admin_phone":"text"}
```

Как видно из вывода, в первых пяти случаях мы вернули имя шаблона, который подошёл
В 6 и 7 случае шаблон найден не был и мы выдали новую структуру шаблона, подходящую для этих данных

Сделал как было написано в тестовом задании, но показалось немного странным: такие разнородные данные будет неудобно разбирать. Кажется что лучше было бы всегда возвращать json, который бы имел поле "status" : {'success'|'fail'} и поле result с результатом, например для успешного:<br>
```
{"status":"success",
"result":{"template_name": "somename"}
}
```

а для неуспешного:<br>
```
{"status":"fail",
"result":{"Last date":"date","comment":"text"}
}
```

## 3. Прочее
Вынесу сюда те пункты, за которые мне слегка стыдно, но мне показалось, что для тестового задания это нормально:
 - размер docker-файла (здесь оправданий нет, нужно было аккуратнее относиться к тому, что я туда тащу и/или разделять на несколько). Если это создает проблемы - скажите, буду пересобирать по другому
 - способ запуска приложения в docker-файле: конечно следовало бы разбить сервис на два докера (БД и само веб-приложение), дать им обоим сеть, написать конфиги так, чтобы они автоматически стартовали
 - кажется есть несколько мест, где мы можем хорошенько грохнуться. Не обкладывал все try-ами и обработкой редких случаев для ускорения и чтобы не ухудшать читаемость
 - тестовых примеров маловато и в целом код следовало бы получше оттестировать (желательно покрыть pytest), в более-менее нетиповых случаях там точно еще придется баги повыгребать
 - код почти без комментариев, он вроде довольно простой и старался писать, так, чтобы читалось нормально, но возможно снабдить некоторые места стоило
